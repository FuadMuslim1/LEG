import{c as y,r as t,q as $,x as F,i as z,o as U,j as e,m as M,D as O,f as n,s as P,T as Y,t as G,e as T,p as J}from"./index-C5MxSQsq.js";import{A as V,T as K}from"./AdminLayout-ySf5CHEQ.js";import{B as Q}from"./log-out-DAX5-8ca.js";import{C as W}from"./circle-check-big-D2dOgAAE.js";import{R as X}from"./rotate-ccw-CqGlC2K7.js";import{E as Z}from"./external-link-B3HVBvR-.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],se=y("info",ee);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],ae=y("message-square",te);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],ne=y("send",le),L=({isOpen:r,title:i,message:o,onConfirm:m,onCancel:d,isProcessing:a,confirmLabel:u="Ya, Hapus",isDestructive:c=!0})=>r?e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-slate-900/50 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsx("div",{className:"bg-white w-full max-w-sm rounded-2xl shadow-2xl overflow-hidden border border-slate-100 animate-in zoom-in-95 duration-200",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3 text-slate-800",children:[e.jsx("div",{className:`p-2 rounded-full ${c?"bg-red-100 text-red-600":"bg-indigo-100 text-indigo-600"}`,children:e.jsx(Y,{size:20})}),e.jsx("h3",{className:"font-bold text-lg",children:i})]}),e.jsx("p",{className:"text-slate-600 text-sm whitespace-pre-wrap leading-relaxed mb-6 pl-1",children:o}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:d,disabled:a,className:"px-4 py-2 rounded-lg text-slate-600 hover:bg-slate-100 font-bold text-xs transition-colors",children:"Batal"}),e.jsxs("button",{onClick:m,disabled:a,className:`px-4 py-2 rounded-lg text-white font-bold text-xs transition-colors flex items-center gap-2 shadow-md 
                ${c?"bg-red-600 hover:bg-red-700 shadow-red-200":"bg-indigo-600 hover:bg-indigo-700 shadow-indigo-200"}`,children:[a&&e.jsx("div",{className:"w-3 h-3 border-2 border-white/30 border-t-white rounded-full animate-spin"}),u]})]})]})})}):null,me=({user:r})=>{const[i,o]=t.useState(!1),[m,d]=t.useState(!1),[a,u]=t.useState([]),[c,B]=t.useState(!0),[h,w]=t.useState(""),[g,N]=t.useState(""),[v,D]=t.useState("ALL"),[k,S]=t.useState(""),[b,f]=t.useState(null),[E,p]=t.useState(!1),[C,x]=t.useState(!1);t.useEffect(()=>{const s=$(z(n,"admin_notification"),F("createdAt","desc")),l=U(s,j=>{const I=j.docs.map(A=>({id:A.id,...A.data()}));u(I),B(!1)});return()=>l()},[]);const H=async s=>{if(s.preventDefault(),!(!h||!g)){o(!0);try{await O(z(n,"admin_notification"),{title:h,message:g,target:v,link:k||null,createdBy:r.uid,createdAt:P()}),w(""),N(""),S(""),d(!0),setTimeout(()=>d(!1),3e3)}catch{alert("Failed to send broadcast.")}finally{o(!1)}}},_=async()=>{if(b){x(!0);try{await G(T(n,"admin_notification",b)),f(null)}catch(s){console.error("Delete failed",s)}finally{x(!1)}}},q=async()=>{x(!0);try{const s=J(n);a.forEach(l=>{const j=T(n,"admin_notification",l.id);s.delete(j)}),await s.commit(),p(!1)}catch(s){console.error("Clear all failed",s)}finally{x(!1)}},R=s=>{if(!s)return"Just now";const l=s.seconds?new Date(s.seconds*1e3):new Date(s);return new Intl.DateTimeFormat("id-ID",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"}).format(l)};return e.jsxs(V,{user:r,title:"Broadcast Center",children:[e.jsx("div",{className:"bg-white border-b border-slate-200 px-6 py-4 sticky top-0 z-10 shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-3 text-indigo-600",children:[e.jsx(Q,{size:20}),e.jsx("span",{className:"font-bold text-sm",children:"System Announcement Manager"})]})}),e.jsx("div",{className:"p-4 md:p-8 max-w-6xl mx-auto",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white p-6 rounded-2xl border border-slate-200 shadow-sm sticky top-24",children:[e.jsxs("h3",{className:"font-bold text-slate-800 flex items-center gap-2 mb-6 text-lg",children:[e.jsx(ae,{size:20,className:"text-indigo-600"}),"Compose Message"]}),m&&e.jsxs("div",{className:"mb-6 p-4 bg-emerald-50 text-emerald-700 text-sm rounded-xl flex items-center gap-2 border border-emerald-100 animate-in fade-in slide-in-from-top-2",children:[e.jsx(W,{size:16}),e.jsx("span",{className:"font-bold",children:"Message sent successfully!"})]}),e.jsxs("form",{onSubmit:H,className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider mb-1.5 block",children:"Title / Subject"}),e.jsx("input",{type:"text",required:!0,value:h,onChange:s=>w(s.target.value),className:"w-full p-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-indigo-500 outline-none text-sm transition-all bg-slate-50 focus:bg-white",placeholder:"e.g. System Maintenance"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider mb-1.5 block",children:"Target Audience"}),e.jsxs("select",{value:v,onChange:s=>D(s.target.value),className:"w-full p-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-indigo-500 outline-none text-sm bg-slate-50 focus:bg-white",children:[e.jsx("option",{value:"ALL",children:"All Users"}),e.jsx("option",{value:"PREMIUM",children:"Premium Members"}),e.jsx("option",{value:"FREE",children:"Free Members"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider mb-1.5 block",children:"Message Body"}),e.jsx("textarea",{required:!0,value:g,onChange:s=>N(s.target.value),className:"w-full p-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-indigo-500 outline-none text-sm h-40 resize-none bg-slate-50 focus:bg-white leading-relaxed",placeholder:"Type your announcement here..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider mb-1.5 block",children:"Action Link (Optional)"}),e.jsx("input",{type:"text",value:k,onChange:s=>S(s.target.value),className:"w-full p-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-indigo-500 outline-none text-sm bg-slate-50 focus:bg-white",placeholder:"https://..."})]}),e.jsx("button",{disabled:i,className:"w-full py-3.5 bg-indigo-600 text-white rounded-xl font-bold shadow-lg shadow-indigo-200 hover:bg-indigo-700 transition-all flex items-center justify-center gap-2 hover:-translate-y-0.5",children:i?"Sending...":e.jsxs(e.Fragment,{children:[e.jsx(ne,{size:18})," Send Broadcast"]})})]})]})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 h-full flex flex-col shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-slate-100 flex justify-between items-center bg-slate-50/50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{size:18,className:"text-slate-500"}),e.jsx("h4",{className:"font-bold text-slate-700",children:"Broadcast History"}),e.jsx("span",{className:"bg-slate-200 text-slate-600 text-[10px] px-2 py-0.5 rounded-full font-bold",children:a.length})]}),a.length>0&&e.jsxs("button",{onClick:()=>p(!0),className:"text-red-500 hover:bg-red-50 px-3 py-1.5 rounded-lg text-xs font-bold flex items-center gap-2 transition-colors",children:[e.jsx(X,{size:14})," Clear All"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 min-h-[400px] bg-slate-50",children:c?e.jsx("div",{className:"text-center py-10 text-slate-400",children:"Loading history..."}):a.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full py-20 text-slate-400",children:[e.jsx(se,{size:40,className:"mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"Belum ada riwayat broadcast."})]}):a.map(s=>e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-slate-200 shadow-sm hover:shadow-md transition-shadow group relative",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`text-[10px] font-bold px-2 py-0.5 rounded border ${s.target==="ALL"?"bg-indigo-50 text-indigo-700 border-indigo-100":"bg-amber-50 text-amber-700 border-amber-100"}`,children:["TARGET: ",s.target]}),e.jsxs("span",{className:"text-[10px] text-slate-400 flex items-center gap-1",children:[e.jsx(M,{size:10})," ",R(s.createdAt)]})]}),e.jsx("button",{onClick:()=>f(s.id),className:"text-slate-300 hover:text-red-500 p-1 rounded transition-colors",title:"Hapus notifikasi ini",children:e.jsx(K,{size:16})})]}),e.jsx("h5",{className:"font-bold text-slate-800 text-sm mb-1",children:s.title}),e.jsx("p",{className:"text-xs text-slate-500 leading-relaxed whitespace-pre-wrap",children:s.message}),s.link&&e.jsxs("div",{className:"mt-3 pt-2 border-t border-slate-50 flex items-center gap-1",children:[e.jsx(Z,{size:12,className:"text-blue-500"}),e.jsx("a",{href:s.link,target:"_blank",rel:"noreferrer",className:"text-xs text-blue-600 hover:underline truncate max-w-md block",children:s.link})]})]},s.id))})]})})]})}),e.jsx(L,{isOpen:!!b,title:"Hapus Notifikasi?",message:"Notifikasi ini akan dihapus dari riwayat admin. (User yang sudah menerima notifikasi mungkin masih melihatnya sampai mereka refresh).",onConfirm:_,onCancel:()=>f(null),isProcessing:C,confirmLabel:"Ya, Hapus"}),e.jsx(L,{isOpen:E,title:"Hapus SEMUA Riwayat?",message:`Anda akan menghapus ${a.length} pesan dari riwayat broadcast. Tindakan ini tidak dapat dibatalkan.`,onConfirm:q,onCancel:()=>p(!1),isProcessing:C,confirmLabel:"Hapus Semua"})]})};export{me as AdminNotification};
